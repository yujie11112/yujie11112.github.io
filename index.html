<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥µè‡´æ°£è±¡å„€è¡¨æ¿</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --card-border: rgba(255, 255, 255, 0.1);
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --accent-color: #38bdf8;
            --modal-bg: rgba(15, 23, 42, 0.95);
        }

        /* éš±è—æ²è»¸ */
        ::-webkit-scrollbar { width: 0; height: 0; }

        body {
            margin: 0; padding: 20px;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        /* --- å‹•æ…‹èƒŒæ™¯ç‰¹æ•ˆ --- */
        .bg-blob {
            position: absolute; border-radius: 50%;
            filter: blur(80px); opacity: 0.6; z-index: -1;
            animation: float 10s infinite alternate;
        }
        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: #4c1d95; animation-delay: 0s; }
        .blob-2 { bottom: -10%; right: -10%; width: 400px; height: 400px; background: #0ea5e9; animation-delay: -5s; }
        .blob-3 { top: 40%; left: 40%; width: 300px; height: 300px; background: #db2777; animation-duration: 15s; opacity: 0.4; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, 50px) scale(1.1); }
        }

        /* --- ä¸»å®¹å™¨ --- */
        .dashboard {
            width: 100%; max-width: 420px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            border-radius: 32px;
            padding: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: flex; flex-direction: column; gap: 20px;
        }

        /* --- é ‚éƒ¨å°èˆª --- */
        .header { display: flex; justify-content: space-between; align-items: center; }
        .greeting-box { display: flex; flex-direction: column; }
        .greeting-time { font-size: 0.8rem; color: var(--accent-color); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        .greeting-text { font-size: 1.4rem; font-weight: 700; }
        
        .city-select {
            background: rgba(255,255,255,0.1); border: 1px solid var(--card-border);
            color: #fff; padding: 8px 16px; border-radius: 20px;
            font-size: 0.9rem; outline: none; cursor: pointer;
            transition: all 0.2s;
        }
        .city-select:hover { background: rgba(255,255,255,0.2); }
        .city-select option { background: #1e293b; color: #fff; }

        /* --- Hero å€åŸŸ --- */
        .hero-card {
            text-align: center; padding: 10px 0;
            position: relative;
        }
        .weather-icon { font-size: 6rem; filter: drop-shadow(0 0 20px rgba(255,255,255,0.2)); animation: bounce 3s infinite ease-in-out; }
        .temp-display { font-size: 4.5rem; font-weight: 800; line-height: 1; margin: 10px 0; letter-spacing: -2px; }
        .weather-status { font-size: 1.2rem; color: var(--text-sub); font-weight: 500; }
        .hl-temp { margin-top: 8px; font-size: 1rem; color: var(--text-sub); display: flex; justify-content: center; gap: 15px; }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* --- è³‡è¨Šæ ¼ (Bento Grid) --- */
        .bento-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
        }
        .bento-item {
            background: var(--card-bg); border-radius: 20px; padding: 16px;
            display: flex; flex-direction: column; justify-content: space-between;
            border: 1px solid var(--card-border);
        }
        .bento-label { font-size: 0.85rem; color: var(--text-sub); display: flex; align-items: center; gap: 6px; }
        .bento-value { font-size: 1.4rem; font-weight: 700; margin-top: 5px; }
        .bento-sub { font-size: 0.75rem; color: var(--text-sub); margin-top: 4px; }

        /* é€²åº¦æ¢æ¨£å¼ */
        .progress-bg { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 8px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 1s ease; }

        /* --- æ©«å‘é å ± --- */
        .forecast-scroll {
            display: flex; overflow-x: auto; gap: 12px; padding: 10px 0;
            scroll-behavior: smooth;
        }
        .forecast-item {
            min-width: 65px; background: rgba(255,255,255,0.05);
            border-radius: 18px; padding: 12px 0; text-align: center;
            border: 1px solid transparent; transition: all 0.2s;
        }
        .forecast-item:hover { background: rgba(255,255,255,0.15); border-color: var(--accent-color); transform: translateY(-2px); }
        .fc-time { font-size: 0.8rem; color: var(--text-sub); margin-bottom: 6px; }
        .fc-icon { font-size: 1.4rem; margin-bottom: 6px; }
        .fc-temp { font-weight: 700; font-size: 1rem; }

        /* --- æŒ‰éˆ•å€ --- */
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .btn {
            background: var(--text-main); color: var(--bg-color);
            border: none; padding: 14px; border-radius: 16px;
            font-weight: 700; cursor: pointer; font-size: 0.95rem;
            display: flex; justify-content: center; align-items: center; gap: 8px;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.96); }
        .btn-outline { background: transparent; border: 2px solid var(--card-border); color: var(--text-main); }
        .btn-outline:hover { background: rgba(255,255,255,0.05); border-color: var(--text-main); }

        /* --- Modal --- */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            display: none; place-items: center; z-index: 100; opacity: 0; transition: opacity 0.3s;
        }
        .modal.show { display: grid; opacity: 1; }
        .modal-box {
            background: #1e293b; padding: 30px; border-radius: 24px;
            width: 85%; max-width: 320px; text-align: center;
            border: 1px solid var(--card-border); transform: scale(0.9); transition: transform 0.3s;
        }
        .modal.show .modal-box { transform: scale(1); }
    </style>
</head>
<body>

    <div class="bg-blob blob-1"></div>
    <div class="bg-blob blob-2"></div>
    <div class="bg-blob blob-3"></div>

    <div class="dashboard">
        <div class="header">
            <div class="greeting-box">
                <span class="greeting-time" id="greeting-time">Good Morning</span>
                <span class="greeting-text" id="current-date">--æœˆ--æ—¥</span>
            </div>
            <select id="city-select" class="city-select" onchange="changeCity()">
                <option value="25.0330,121.5654">ğŸ“ å°åŒ—å¸‚</option>
                <option value="24.1477,120.6736">ğŸ“ å°ä¸­å¸‚</option>
                <option value="22.6163,120.2937">ğŸ“ é«˜é›„å¸‚</option>
                <option value="24.8039,120.9647">ğŸ“ æ–°ç«¹å¸‚</option>
                <option value="23.9772,121.6047">ğŸ“ èŠ±è“®å¸‚</option>
                <option value="22.7583,121.1444">ğŸ“ å°æ±å¸‚</option>
                <option disabled>â”€â”€â”€â”€â”€â”€</option>
                <option value="35.6895,139.6917">ğŸ‡¯ğŸ‡µ æ±äº¬</option>
                <option value="37.5665,126.9780">ğŸ‡°ğŸ‡· é¦–çˆ¾</option>
                <option value="40.7128,-74.0060">ğŸ‡ºğŸ‡¸ ç´ç´„</option>
                <option value="48.8566,2.3522">ğŸ‡«ğŸ‡· å·´é»</option>
                <option value="gps">ğŸ“¡ å®šä½</option>
            </select>
        </div>

        <div class="hero-card">
            <div class="weather-icon" id="hero-icon">ğŸŒ¤ï¸</div>
            <div class="temp-display" id="hero-temp">--Â°</div>
            <div class="weather-status" id="weather-desc">è¼‰å…¥ä¸­...</div>
            <div class="hl-temp">
                <span>ğŸ”º <span id="max-temp">--</span>Â°</span>
                <span>ğŸ”» <span id="min-temp">--</span>Â°</span>
            </div>
        </div>

        <div>
            <div style="font-size: 0.85rem; color: var(--text-sub); margin-bottom: 10px; font-weight: 600;">24å°æ™‚é å ±</div>
            <div class="forecast-scroll" id="hourly-scroll">
                </div>
        </div>

        <div class="bento-grid">
            <div class="bento-item">
                <div class="bento-label">â˜” é™é›¨æ©Ÿç‡</div>
                <div class="bento-value" id="rain-prob">--%</div>
                <div class="progress-bg"><div class="progress-fill" id="rain-bar" style="width: 0%; background: #38bdf8;"></div></div>
                <div class="bento-sub">å‡ºé–€è¨˜å¾—å¸¶å‚˜</div>
            </div>
            <div class="bento-item">
                <div class="bento-label">â˜€ï¸ ç´«å¤–ç·š (UV)</div>
                <div class="bento-value" id="uv-index">--</div>
                <div class="progress-bg"><div class="progress-fill" id="uv-bar" style="width: 0%; background: #facc15;"></div></div>
                <div class="bento-sub" id="uv-text">å¼±</div>
            </div>
            <div class="bento-item">
                <div class="bento-label">ğŸŒ¡ï¸ é«”æ„Ÿæº«åº¦</div>
                <div class="bento-value" id="feels-like">--Â°</div>
                <div class="bento-sub">å¯¦éš›æ„Ÿå—</div>
            </div>
            <div class="bento-item">
                <div class="bento-label">ğŸ’§ ç›¸å°æ¿•åº¦</div>
                <div class="bento-value" id="humidity">--%</div>
                <div class="bento-sub">ç©ºæ°£æ¿•åº¦</div>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-outline" onclick="toggleUnit()">ğŸŒ¡ï¸ å–®ä½åˆ‡æ›</button>
            <button class="btn" onclick="showAdvice()">âœ¨ ç©¿æ­å»ºè­°</button>
        </div>
    </div>

    <div class="modal" id="advice-modal" onclick="closeModal(event)">
        <div class="modal-box">
            <div style="font-size: 3rem; margin-bottom: 15px;" id="advice-emoji">ğŸ‘•</div>
            <h3 style="margin: 0 0 10px 0;">ä»Šæ—¥å»ºè­°</h3>
            <p style="color: var(--text-sub); line-height: 1.6; margin-bottom: 20px;" id="advice-text">åˆ†æä¸­...</p>
            <button class="btn" style="width: 100%" onclick="closeModalBtn()">çŸ¥é“äº†</button>
        </div>
    </div>

    <script>
        // --- ç‹€æ…‹è®Šæ•¸ ---
        let isCelsius = true;
        let weatherData = {};
        
        // å¤©æ°£ä»£ç¢¼è¡¨
        const weatherCodes = {
            0: {t: "æ™´æœ—", i: "â˜€ï¸"}, 1: {t: "å¤§è‡´æ™´æœ—", i: "ğŸŒ¤ï¸"}, 2: {t: "å¤šé›²", i: "â›…"}, 3: {t: "é™°å¤©", i: "â˜ï¸"},
            45: {t: "éœ§", i: "ğŸŒ«ï¸"}, 51: {t: "ç´°é›¨", i: "ğŸŒ§ï¸"}, 61: {t: "å°é›¨", i: "â˜”"}, 63: {t: "é™é›¨", i: "â˜”"},
            65: {t: "å¤§é›¨", i: "â›ˆï¸"}, 80: {t: "é™£é›¨", i: "ğŸŒ¦ï¸"}, 95: {t: "é›·é›¨", i: "âš¡"}
        };

        // --- åˆå§‹åŒ–èˆ‡æ™‚é–“ ---
        function init() {
            updateTimeGreeting();
            setInterval(updateTimeGreeting, 60000);
            
            // è®€å–ä¸Šæ¬¡é¸æ“‡çš„åŸå¸‚
            const savedCity = localStorage.getItem('weather_city');
            if(savedCity) {
                document.getElementById('city-select').value = savedCity;
            }
            changeCity(); // é–‹å§‹æŠ“è³‡æ–™
        }

        function updateTimeGreeting() {
            const now = new Date();
            const hour = now.getHours();
            const dateStr = now.toLocaleDateString('zh-TW', {month:'numeric', day:'numeric', weekday:'short'});
            
            let greeting = "Good Evening";
            if(hour >= 5 && hour < 12) greeting = "Good Morning";
            else if(hour >= 12 && hour < 18) greeting = "Good Afternoon";
            
            document.getElementById('greeting-time').innerText = greeting;
            document.getElementById('current-date').innerText = dateStr;
        }

        // --- è³‡æ–™æŠ“å– ---
        async function fetchWeather(lat, lon) {
            // åŠ å…¥ precipitation_probability_max, uv_index_max
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code&hourly=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max,uv_index_max&timezone=auto`;

            try {
                document.getElementById('weather-desc').innerText = "æ›´æ–°ä¸­...";
                const res = await fetch(url);
                const data = await res.json();
                weatherData = data; // å­˜èµ·ä¾†ä¾›å–®ä½åˆ‡æ›ç”¨
                render(data);
            } catch(e) {
                console.error(e);
                document.getElementById('weather-desc').innerText = "é€£ç·šå¤±æ•—";
            }
        }

        function render(data) {
            const cur = data.current;
            const day = data.daily;
            const w = weatherCodes[cur.weather_code] || {t:"æœªçŸ¥", i:"â“"};

            // 1. Hero
            const temp = isCelsius ? cur.temperature_2m : (cur.temperature_2m * 1.8 + 32);
            document.getElementById('hero-temp').innerText = Math.round(temp) + (isCelsius ? "Â°" : "Â°F");
            document.getElementById('hero-icon').innerText = w.i;
            document.getElementById('weather-desc').innerText = w.t;
            
            const max = isCelsius ? day.temperature_2m_max[0] : (day.temperature_2m_max[0] * 1.8 + 32);
            const min = isCelsius ? day.temperature_2m_min[0] : (day.temperature_2m_min[0] * 1.8 + 32);
            document.getElementById('max-temp').innerText = Math.round(max);
            document.getElementById('min-temp').innerText = Math.round(min);

            // 2. Bento Grid
            // é™é›¨
            const rainProb = day.precipitation_probability_max[0] || 0;
            document.getElementById('rain-prob').innerText = rainProb + "%";
            document.getElementById('rain-bar').style.width = rainProb + "%";
            
            // UV
            const uv = day.uv_index_max[0];
            document.getElementById('uv-index').innerText = uv;
            // UV é¡è‰²èˆ‡æ–‡å­—
            let uvColor = "#a3e635"; let uvText = "ä½";
            if(uv >= 3) { uvColor = "#facc15"; uvText = "ä¸­"; }
            if(uv >= 6) { uvColor = "#f97316"; uvText = "é«˜"; }
            if(uv >= 8) { uvColor = "#ef4444"; uvText = "å±éšª"; }
            document.getElementById('uv-bar').style.background = uvColor;
            document.getElementById('uv-bar').style.width = Math.min((uv/11)*100, 100) + "%";
            document.getElementById('uv-text').innerText = uvText;

            // æ¿•åº¦èˆ‡é«”æ„Ÿ
            document.getElementById('humidity').innerText = cur.relative_humidity_2m + "%";
            const feel = isCelsius ? cur.apparent_temperature : (cur.apparent_temperature * 1.8 + 32);
            document.getElementById('feels-like').innerText = Math.round(feel) + "Â°";

            // 3. Hourly Scroll
            const scroll = document.getElementById('hourly-scroll');
            scroll.innerHTML = '';
            const nowHour = new Date().getHours();
            
            for(let i=nowHour; i<nowHour+24; i++) {
                if(!data.hourly.time[i]) break;
                const hTemp = data.hourly.temperature_2m[i];
                const displayTemp = isCelsius ? Math.round(hTemp) : Math.round(hTemp * 1.8 + 32);
                const hCode = data.hourly.weather_code[i];
                const hTime = i + ":00";
                
                const div = document.createElement('div');
                div.className = 'forecast-item';
                div.innerHTML = `
                    <div class="fc-time">${i===nowHour?'ç¾åœ¨':hTime}</div>
                    <div class="fc-icon">${(weatherCodes[hCode]||{i:'â˜ï¸'}).i}</div>
                    <div class="fc-temp">${displayTemp}Â°</div>
                `;
                scroll.appendChild(div);
            }
        }

        // --- äº’å‹•åŠŸèƒ½ ---
        function changeCity() {
            const select = document.getElementById('city-select');
            const val = select.value;
            
            if(val === 'gps') {
                if(navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(pos => {
                        fetchWeather(pos.coords.latitude, pos.coords.longitude);
                        localStorage.removeItem('weather_city'); // GPS ä¸å­˜
                    });
                }
            } else {
                localStorage.setItem('weather_city', val); // è¨˜æ†¶é¸æ“‡
                const [lat, lon] = val.split(',');
                fetchWeather(lat, lon);
            }
        }

        function toggleUnit() {
            isCelsius = !isCelsius;
            if(weatherData.current) render(weatherData);
        }

        function showAdvice() {
            const cur = weatherData.current;
            if(!cur) return;
            
            const temp = cur.temperature_2m;
            const rain = weatherData.daily.precipitation_probability_max[0];
            let msg = ""; let emoji = "ğŸ‘•";

            if(temp < 15) { emoji="ğŸ§£"; msg="å¤–é¢é —æœ‰å¯’æ„ï¼Œå»ºè­°ç©¿ç™¼ç†±è¡£ã€æ¯›è¡£æˆ–åšå¤–å¥—ï¼Œåœå·¾ä¹Ÿå¸¶è‘—å§ï¼"; }
            else if(temp < 22) { emoji="ğŸ§¥"; msg="æ¶¼çˆ½èˆ’é©ï¼Œç©¿ä»¶è–„é•·è¢–æˆ–æ­é…ä¸€ä»¶ç‰›ä»”å¤–å¥—æœ€å‰›å¥½ã€‚"; }
            else if(temp < 28) { emoji="ğŸ‘•"; msg="å¤©æ°£æº«æš–ï¼ŒçŸ­è¢–æ­é…è–„è¥¯è¡«ï¼Œæˆ–è€…èˆ’é©çš„æ£‰è³ªä¸Šè¡£å³å¯ã€‚"; }
            else { emoji="ğŸ•¶ï¸"; msg="ç†±åŠ›åè¶³ï¼è«‹ç©¿è‘—é€æ°£æ¶¼çˆ½çš„è¡£ç‰©ï¼Œä¸¦æ³¨æ„é˜²æ›¬è£œæ°´ã€‚"; }

            if(rain > 40) msg += "<br><br>â˜” é™é›¨æ©Ÿç‡è¼ƒé«˜ï¼Œå‡ºé–€åˆ¥å¿˜äº†å¸¶å‚˜ï¼";

            document.getElementById('advice-emoji').innerText = emoji;
            document.getElementById('advice-text').innerHTML = msg;
            document.getElementById('advice-modal').classList.add('show');
        }

        function closeModal(e) { if(e.target === document.getElementById('advice-modal')) closeModalBtn(); }
        function closeModalBtn() { document.getElementById('advice-modal').classList.remove('show'); }

        // Start
        init();
    </script>
</body>
</html>
