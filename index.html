<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬ä¸»çš„æ°£è±¡ä¸­æ§å°</title>
    <style>
        :root {
            /* é è¨­ä¸»é¡Œï¼šæ·±æµ·è— */
            --bg-gradient: linear-gradient(160deg, #1b2e4b 0%, #243b55 50%, #141E30 100%);
            --card-bg: rgba(255, 255, 255, 0.1);
            --card-border: rgba(255, 255, 255, 0.15);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --btn-bg: rgba(255, 255, 255, 0.2);
            --modal-bg: rgba(30, 30, 40, 0.9);
        }

        /* ä¸»é¡Œè®Šæ•¸å®šç¾© */
        [data-theme="pink"] {
            --bg-gradient: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 99%, #FECFEF 100%);
            --text-primary: #5c3a45;
            --text-secondary: #8e6e79;
            --card-bg: rgba(255, 255, 255, 0.35);
            --card-border: #fff;
            --btn-bg: rgba(255, 255, 255, 0.5);
            --modal-bg: rgba(255, 240, 245, 0.95);
        }

        [data-theme="aurora"] {
            --bg-gradient: linear-gradient(45deg, #0093E9 10%, #80D0C7 100%);
            --text-primary: #004d40;
            --text-secondary: #00695c;
            --card-bg: rgba(255, 255, 255, 0.3);
            --card-border: rgba(255,255,255,0.6);
            --modal-bg: rgba(220, 255, 250, 0.95);
        }

        * { box-sizing: border-box; transition: all 0.3s ease; }

        body {
            margin: 0; padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex; justify-content: center; align-items: flex-start;
        }

        .dashboard {
            width: 100%; max-width: 480px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 30px;
            border: 1px solid var(--card-border);
            padding: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            position: relative;
        }

        /* äº’å‹•å·¥å…·åˆ— */
        .toolbar {
            display: flex; gap: 10px; margin-bottom: 20px;
            overflow-x: auto; padding-bottom: 5px;
        }
        
        .tool-btn {
            background: var(--btn-bg); border: none;
            color: var(--text-primary);
            padding: 8px 16px; border-radius: 20px;
            font-size: 0.9rem; font-weight: 600;
            cursor: pointer; white-space: nowrap;
            display: flex; align-items: center; gap: 5px;
        }
        .tool-btn:hover { transform: scale(1.05); filter: brightness(1.1); }
        .tool-btn.active { background: #fff; color: #333; }

        /* åŸå¸‚é¸å–®èˆ‡æ™‚é–“ */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .city-select {
            background: var(--btn-bg); border: none; color: var(--text-primary);
            padding: 8px 12px; border-radius: 12px; font-size: 1rem; font-weight: 600;
            outline: none; cursor: pointer;
        }
        .city-select option { background: #333; color: #fff; }
        .current-date { font-size: 0.9rem; color: var(--text-secondary); }

        /* æ ¸å¿ƒå¤©æ°£ */
        .hero-weather { text-align: center; padding: 20px 0; }
        .hero-temp { font-size: 5.5rem; font-weight: 200; line-height: 1; letter-spacing: -2px; }
        .hero-desc { font-size: 1.5rem; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .hero-hl { margin-top: 10px; font-size: 1rem; color: var(--text-secondary); }

        /* é å ±æ²è»¸ */
        .section-title { font-size: 0.85rem; text-transform: uppercase; color: var(--text-secondary); margin: 25px 0 10px 0; font-weight: 600; }
        .hourly-scroll { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 10px; scrollbar-width: none; }
        .hourly-scroll::-webkit-scrollbar { display: none; }
        .hour-item {
            background: var(--card-bg); border: 1px solid var(--card-border);
            border-radius: 16px; padding: 15px 10px; min-width: 70px;
            text-align: center; flex-shrink: 0;
        }
        .hour-time { font-size: 0.85rem; margin-bottom: 8px; color: var(--text-secondary); }
        .hour-icon { font-size: 1.5rem; margin-bottom: 8px; }
        .hour-temp { font-weight: bold; }

        /* å½ˆå‡ºè¦–çª— (Modal) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 100;
            display: none; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.show { display: flex; opacity: 1; }
        .modal-content {
            background: var(--modal-bg);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            padding: 30px; border-radius: 25px; width: 85%; max-width: 350px;
            text-align: center; color: var(--text-primary);
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: scale(0.9); transition: transform 0.3s;
        }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-icon { font-size: 4rem; margin-bottom: 15px; display: block;}
        .modal-title { font-size: 1.5rem; margin: 0 0 10px 0; }
        .modal-text { font-size: 1.1rem; line-height: 1.6; opacity: 0.9; margin-bottom: 25px; }
        .close-btn {
            background: var(--text-primary); color: var(--bg-gradient); /* åè‰² */
            border: none; padding: 10px 25px; border-radius: 20px;
            font-weight: bold; cursor: pointer;
        }

        /* åº•éƒ¨ç´°ç¯€ */
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .detail-card { background: var(--card-bg); border-radius: 16px; padding: 15px; border: 1px solid var(--card-border); }
        .detail-title { font-size: 0.8rem; color: var(--text-secondary); text-transform: uppercase; }
        .detail-value { font-size: 1.5rem; font-weight: 600; }
    </style>
</head>
<body>

<div class="dashboard" id="main-dash">
    
    <div class="toolbar">
        <button class="tool-btn" onclick="toggleUnit()">ğŸŒ¡ï¸ Â°C/Â°F</button>
        <button class="tool-btn" onclick="showOutfitAdvice()">ğŸ‘— ç©¿æ­å»ºè­°</button>
        <button class="tool-btn" onclick="cycleTheme()">ğŸ¨ æ›å€‹å¿ƒæƒ…</button>
    </div>

    <div class="header">
        <select id="city-select" class="city-select" onchange="changeCity()">
            <option value="25.0330,121.5654" selected>ğŸ“ å°åŒ—å¸‚</option>
            <option value="24.1477,120.6736">ğŸ“ å°ä¸­å¸‚</option>
            <option value="22.6163,120.2937">ğŸ“ é«˜é›„å¸‚</option>
            <option value="23.9772,121.6047">ğŸ“ èŠ±è“®å¸‚</option>
            <option value="35.6895,139.6917">ğŸ‡¯ğŸ‡µ æ±äº¬</option>
            <option value="40.7128,-74.0060">ğŸ‡ºğŸ‡¸ ç´ç´„</option>
            <option value="gps">ğŸ“¡ å®šä½æˆ‘çš„ä½ç½®</option>
        </select>
        <div class="current-date" id="date-display">--æœˆ--æ—¥</div>
    </div>

    <div class="hero-weather">
        <div class="hero-desc">
            <span id="hero-icon">ğŸŒ¤ï¸</span> 
            <span id="hero-text">--</span>
        </div>
        <div class="hero-temp" id="hero-temp">--</div>
        <div class="hero-hl">
            é«˜ <span id="today-high">--</span>Â° 
            ä½ <span id="today-low">--</span>Â°
        </div>
    </div>

    <div class="section-title">â° 24å°æ™‚é å ± (å¯æ»‘å‹•)</div>
    <div class="hourly-scroll" id="hourly-container"></div>

    <div class="section-title">ğŸ“Š è©³ç´°æ•¸æ“š</div>
    <div class="details-grid">
        <div class="detail-card">
            <div class="detail-title">é«”æ„Ÿæº«åº¦</div>
            <div class="detail-value" id="detail-feels">--Â°</div>
        </div>
        <div class="detail-card">
            <div class="detail-title">æ¿•åº¦</div>
            <div class="detail-value" id="detail-humidity">--%</div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="advice-modal" onclick="closeModal(event)">
    <div class="modal-content">
        <span class="modal-icon" id="advice-icon">ğŸ§£</span>
        <h2 class="modal-title">å…¬ä¸»çš„ç©¿æ­å»ºè­°</h2>
        <p class="modal-text" id="advice-text">æ­£åœ¨åˆ†æå¤©æ°£...</p>
        <button class="close-btn" onclick="document.getElementById('advice-modal').classList.remove('show')">æ”¶åˆ°ï¼</button>
    </div>
</div>

<script>
    // å…¨åŸŸè®Šæ•¸
    let isCelsius = true;
    let currentTempC = 0;
    let weatherCode = 0;
    let themeIndex = 0;
    const themes = ['default', 'pink', 'aurora'];

    // å¤©æ°£ä»£ç¢¼è¡¨
    const weatherMap = {
        0: { t: "æ™´æœ—", i: "â˜€ï¸" }, 1: { t: "å¤šé›²", i: "ğŸŒ¤ï¸" }, 2: { t: "å¤šé›²", i: "â›…" },
        3: { t: "é™°å¤©", i: "â˜ï¸" }, 45: { t: "éœ§", i: "ğŸŒ«ï¸" }, 61: { t: "ä¸‹é›¨", i: "â˜”" },
        63: { t: "å¤§é›¨", i: "â›ˆï¸" }, 95: { t: "é›·é›¨", i: "âš¡" }
    };
    function getW(code) { return weatherMap[code] || { t: "å¤šé›²", i: "â˜ï¸" }; }

    // æ›´æ–°æ™‚é–“
    function updateTime() {
        const now = new Date();
        document.getElementById('date-display').innerText = now.toLocaleDateString('zh-TW', { month: 'long', day: 'numeric', weekday: 'short', hour: '2-digit', minute: '2-digit' });
    }
    setInterval(updateTime, 60000); updateTime();

    // 1. æŠ“å–å¤©æ°£ API
    async function fetchWeather(lat, lon) {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code&hourly=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min&timezone=auto`;
        try {
            const res = await fetch(url);
            const data = await res.json();
            renderData(data);
        } catch (e) { alert("ç„¡æ³•å–å¾—å¤©æ°£è³‡æ–™"); }
    }

    // 2. æ¸²æŸ“ç•«é¢
    function renderData(data) {
        const current = data.current;
        const daily = data.daily;
        const hourly = data.hourly;
        
        // å„²å­˜å…¨åŸŸè®Šæ•¸ä¾›å…¶ä»–åŠŸèƒ½ä½¿ç”¨
        currentTempC = current.temperature_2m;
        weatherCode = current.weather_code;

        updateTempDisplay(currentTempC, daily.temperature_2m_max[0], daily.temperature_2m_min[0], current.apparent_temperature);

        document.getElementById('hero-text').innerText = getW(weatherCode).t;
        document.getElementById('hero-icon').innerText = getW(weatherCode).i;
        document.getElementById('detail-humidity').innerText = current.relative_humidity_2m + "%";

        // è™•ç†å°æ™‚é å ±
        const container = document.getElementById('hourly-container');
        container.innerHTML = '';
        const nowHour = new Date().getHours();
        for(let i = nowHour; i < nowHour + 24; i++) {
            if(!hourly.time[i]) break;
            const temp = hourly.temperature_2m[i];
            const displayTemp = isCelsius ? Math.round(temp) : Math.round(temp * 1.8 + 32);
            
            const div = document.createElement('div');
            div.className = 'hour-item';
            div.innerHTML = `
                <div class="hour-time">${i}:00</div>
                <div class="hour-icon">${getW(hourly.weather_code[i]).i}</div>
                <div class="hour-temp">${displayTemp}Â°</div>
            `;
            container.appendChild(div);
        }
    }

    // 3. æº«åº¦æ›´æ–°é‚è¼¯ (C/F åˆ‡æ›ç”¨)
    function updateTempDisplay(temp, max, min, feels) {
        const t = isCelsius ? Math.round(temp) : Math.round(temp * 1.8 + 32);
        const h = isCelsius ? Math.round(max) : Math.round(max * 1.8 + 32);
        const l = isCelsius ? Math.round(min) : Math.round(min * 1.8 + 32);
        const f = isCelsius ? Math.round(feels) : Math.round(feels * 1.8 + 32);
        const unit = isCelsius ? "Â°C" : "Â°F";

        document.getElementById('hero-temp').innerHTML = `${t}<span style="font-size:2rem">${unit}</span>`;
        document.getElementById('today-high').innerText = h;
        document.getElementById('today-low').innerText = l;
        document.getElementById('detail-feels').innerText = f + "Â°";
    }

    // --- äº’å‹•åŠŸèƒ½å€ ---

    // åŠŸèƒ½ A: å–®ä½åˆ‡æ›
    function toggleUnit() {
        isCelsius = !isCelsius;
        // é‡æ–°æŠ“å–è³‡æ–™å¤ªæ…¢ï¼Œç›´æ¥è§¸ç™¼é¸å–®æ”¹è®Šäº‹ä»¶ä¾†é‡æ–°æ¸²æŸ“æœ€ç°¡å–®ï¼Œä½†é€™è£¡ç‚ºäº†æµæš¢ï¼Œ
        // æˆ‘å€‘å‡è¨­è³‡æ–™å·²ç¶“åœ¨è®Šæ•¸è£¡ï¼Œç›´æ¥å‘¼å«ä¸€æ¬¡ fetchWeather å¤ªæµªè²»ã€‚
        // ç‚ºäº†ç°¡å–®èµ·è¦‹ï¼Œé€™è£¡ç›´æ¥é‡æ–°è§¸ç™¼ä¸€æ¬¡ç›®å‰çš„åŸå¸‚æŸ¥è©¢
        const select = document.getElementById('city-select');
        const [lat, lon] = select.value.split(',');
        if(select.value !== 'gps') fetchWeather(lat, lon);
        else getLocation(); // å¦‚æœæ˜¯ GPS æ¨¡å¼
    }

    // åŠŸèƒ½ B: ç©¿æ­å»ºè­°é‚è¼¯
    function showOutfitAdvice() {
        const modal = document.getElementById('advice-modal');
        const icon = document.getElementById('advice-icon');
        const text = document.getElementById('advice-text');
        
        let advice = "";
        let emoji = "";

        // ç°¡å–®çš„æº«åº¦åˆ¤æ–·é‚è¼¯
        if (currentTempC < 15) {
            emoji = "ğŸ§£";
            advice = "å¤–é¢å¥½å†·å–”ï¼å»ºè­°ç©¿ä¸Šåšå¤–å¥—ã€åœå·¾ï¼Œæˆ–æ˜¯å¤šå±¤æ¬¡ç©¿æ­ã€‚è¨˜å¾—ä¿æš–åˆ¥æ„Ÿå†’äº†ï¼";
        } else if (currentTempC < 20) {
            emoji = "ğŸ§¥";
            advice = "ç¨å¾®æœ‰é»æ¶¼æ„ï¼Œç©¿ä»¶é‡ç¹”è¡«ã€å¸½Tæˆ–æ˜¯è–„å¤¾å…‹å‰›å‰›å¥½ã€‚";
        } else if (currentTempC < 26) {
            emoji = "ğŸ‘•";
            advice = "å¤©æ°£å¾ˆèˆ’é©ï¼ç©¿çŸ­è¢–é…ä¸€ä»¶è–„è¥¯è¡«ï¼Œæˆ–æ˜¯èˆ’é©çš„é•·è¢–ä¸Šè¡£éƒ½å¯ä»¥å–”ã€‚";
        } else {
            emoji = "ğŸ•¶ï¸";
            advice = "å¤©æ°£ç‚ç†±ï¼Œå»ºè­°ç©¿è‘—é€æ°£çš„çŸ­è¢–ã€è£™å­ï¼Œè¨˜å¾—å¤šè£œå……æ°´åˆ†ä¸¦æ³¨æ„é˜²æ›¬ï¼";
        }

        // å¦‚æœä¸‹é›¨
        if ([61, 63, 65, 80, 95].includes(weatherCode)) {
            advice += "<br><br>â˜” å¦å¤–ï¼Œå¤–é¢åœ¨ä¸‹é›¨ï¼Œåˆ¥å¿˜äº†å¸¶å‚˜ï¼";
        }

        icon.innerText = emoji;
        text.innerHTML = advice;
        modal.classList.add('show');
    }

    function closeModal(e) {
        if(e.target === document.getElementById('advice-modal')) {
            document.getElementById('advice-modal').classList.remove('show');
        }
    }

    // åŠŸèƒ½ C: ä¸»é¡Œåˆ‡æ›
    function cycleTheme() {
        themeIndex = (themeIndex + 1) % themes.length;
        const theme = themes[themeIndex];
        if(theme === 'default') {
            document.documentElement.removeAttribute('data-theme');
        } else {
            document.documentElement.setAttribute('data-theme', theme);
        }
    }

    // åŸå¸‚åˆ‡æ›
    function changeCity() {
        const select = document.getElementById('city-select');
        if(select.value === 'gps') getLocation();
        else {
            const [lat, lon] = select.value.split(',');
            fetchWeather(lat, lon);
        }
    }

    function getLocation() {
        if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                fetchWeather(pos.coords.latitude, pos.coords.longitude);
            });
        }
    }

    // åˆå§‹åŸ·è¡Œ
    window.onload = () => changeCity();

</script>
</body>
</html>
