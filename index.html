<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¥­æ°£è±¡å„€è¡¨æ¿</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(160deg, #1b2e4b 0%, #243b55 50%, #141E30 100%);
            --card-bg: rgba(255, 255, 255, 0.1);
            --card-border: rgba(255, 255, 255, 0.15);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --accent: #facc15; /* é»ƒè‰²é»ç¶´ */
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* æ”¹ç‚ºé ä¸Šå°é½Šï¼Œé©æ‡‰é•·å…§å®¹ */
        }

        /* ä¸»å®¹å™¨ï¼šé™åˆ¶æœ€å¤§å¯¬åº¦ï¼Œåƒæ‰‹æ©Ÿ App */
        .dashboard {
            width: 100%;
            max-width: 480px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 1px solid var(--card-border);
            padding: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* é ‚éƒ¨é¸å–®èˆ‡æ™‚é–“ */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .city-select {
            background: rgba(255,255,255,0.15);
            border: none;
            color: #fff;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            outline: none;
            cursor: pointer;
        }

        .city-select option {
            background: #243b55;
            color: #fff;
        }

        .current-date {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* æ ¸å¿ƒå¤©æ°£å€å¡Š (å¤§å­—) */
        .hero-weather {
            text-align: center;
            padding: 20px 0;
        }

        .hero-temp {
            font-size: 5.5rem;
            font-weight: 200;
            line-height: 1;
            letter-spacing: -2px;
        }

        .hero-desc {
            font-size: 1.5rem;
            font-weight: 500;
            margin-top: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .hero-hl {
            margin-top: 10px;
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* 24å°æ™‚æ©«å‘æ²è»¸ */
        .section-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin: 25px 0 10px 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .hourly-scroll {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 10px;
            /* éš±è—æ²è»¸ */
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        .hourly-scroll::-webkit-scrollbar { 
            display: none; 
        }

        .hour-item {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 15px 10px;
            min-width: 70px;
            text-align: center;
            flex-shrink: 0;
        }

        .hour-time { font-size: 0.85rem; margin-bottom: 8px; color: var(--text-secondary); }
        .hour-icon { font-size: 1.5rem; margin-bottom: 8px; }
        .hour-temp { font-weight: bold; }

        /* æœªä¾†é å ±åˆ—è¡¨ */
        .daily-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .day-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 5px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .day-name { width: 60px; font-weight: 600; }
        .day-icon { width: 40px; text-align: center; }
        .day-temp-bar { 
            display: flex; 
            gap: 10px; 
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        .temp-high { color: #fff; font-weight: 600; }

        /* è©³ç´°è³‡è¨Šç¶²æ ¼ */
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .detail-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid var(--card-border);
        }

        .detail-title {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .detail-value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .detail-sub {
            font-size: 0.8rem;
            margin-top: 5px;
            opacity: 0.8;
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body>

<div class="dashboard" id="main-dash">
    <div class="header">
        <select id="city-select" class="city-select" onchange="changeCity()">
            <option value="25.0330,121.5654" selected>ğŸ“ å°åŒ—å¸‚</option>
            <option value="24.1477,120.6736">ğŸ“ å°ä¸­å¸‚</option>
            <option value="22.6163,120.2937">ğŸ“ é«˜é›„å¸‚</option>
            <option value="24.8039,120.9647">ğŸ“ æ–°ç«¹å¸‚</option>
            <option value="22.9997,120.2270">ğŸ“ å°å—å¸‚</option>
            <option value="23.9772,121.6047">ğŸ“ èŠ±è“®å¸‚</option>
            <option disabled>â”€â”€â”€â”€â”€â”€</option>
            <option value="35.6895,139.6917">ğŸ‡¯ğŸ‡µ æ±äº¬</option>
            <option value="37.5665,126.9780">ğŸ‡°ğŸ‡· é¦–çˆ¾</option>
            <option value="51.5074,-0.1278">ğŸ‡¬ğŸ‡§ å€«æ•¦</option>
            <option value="40.7128,-74.0060">ğŸ‡ºğŸ‡¸ ç´ç´„</option>
            <option disabled>â”€â”€â”€â”€â”€â”€</option>
            <option value="gps">ğŸ“¡ æˆ‘çš„ä½ç½®</option>
        </select>
        <div class="current-date" id="date-display">--æœˆ--æ—¥</div>
    </div>

    <div class="hero-weather">
        <div class="hero-desc">
            <span id="hero-icon">ğŸŒ¤ï¸</span> 
            <span id="hero-text">--</span>
        </div>
        <div class="hero-temp" id="hero-temp">--Â°</div>
        <div class="hero-hl">
            æœ€é«˜ <span id="today-high">--</span>Â° 
            æœ€ä½ <span id="today-low">--</span>Â°
        </div>
    </div>

    <div class="section-title">â° 24å°æ™‚é å ± (å¾€å·¦æ»‘å‹•)</div>
    <div class="hourly-scroll" id="hourly-container">
        </div>

    <div class="section-title">ğŸ“… æœªä¾† 7 å¤©</div>
    <div class="daily-list" id="daily-container">
        </div>

    <div class="section-title">ğŸ“Š è©³ç´°æ•¸æ“š</div>
    <div class="details-grid">
        <div class="detail-card">
            <div class="detail-title">é«”æ„Ÿæº«åº¦</div>
            <div class="detail-value" id="detail-feels">--Â°</div>
            <div class="detail-sub">å¯¦éš›æ„Ÿå—</div>
        </div>
        <div class="detail-card">
            <div class="detail-title">æ¿•åº¦</div>
            <div class="detail-value" id="detail-humidity">--%</div>
            <div class="detail-sub">éœ²é» --Â°</div>
        </div>
        <div class="detail-card">
            <div class="detail-title">é¢¨é€Ÿ</div>
            <div class="detail-value" id="detail-wind">--</div>
            <div class="detail-sub">km/h</div>
        </div>
        <div class="detail-card">
            <div class="detail-title">æ—¥å‡º/æ—¥è½</div>
            <div class="detail-value" style="font-size: 1.2rem;" id="detail-sun">--:--</div>
            <div class="detail-sub">æ—¥è½æ™‚é–“</div>
        </div>
    </div>
</div>

<script>
    // å¤©æ°£ä»£ç¢¼è¡¨
    const weatherMap = {
        0: { t: "æ™´æœ—", i: "â˜€ï¸" }, 1: { t: "å¤šé›²", i: "ğŸŒ¤ï¸" }, 2: { t: "å¤šé›²", i: "â›…" },
        3: { t: "é™°å¤©", i: "â˜ï¸" }, 45: { t: "éœ§", i: "ğŸŒ«ï¸" }, 51: { t: "æ¯›æ¯›é›¨", i: "ğŸŒ§ï¸" },
        53: { t: "ç´°é›¨", i: "ğŸŒ§ï¸" }, 61: { t: "å°é›¨", i: "â˜”" }, 63: { t: "ä¸­é›¨", i: "â˜”" },
        65: { t: "å¤§é›¨", i: "â›ˆï¸" }, 80: { t: "é™£é›¨", i: "ğŸŒ¦ï¸" }, 95: { t: "é›·é›¨", i: "âš¡" }
    };

    function getW(code) { return weatherMap[code] || { t: "æœªçŸ¥", i: "â“" }; }
    
    // æ›´æ–°æ™‚é–“
    function updateTime() {
        const now = new Date();
        const options = { month: 'long', day: 'numeric', weekday: 'short', hour: '2-digit', minute: '2-digit' };
        document.getElementById('date-display').innerText = now.toLocaleDateString('zh-TW', options);
    }
    setInterval(updateTime, 60000);
    updateTime();

    // æŠ“å–æ•¸æ“š
    async function fetchWeather(lat, lon) {
        const dash = document.getElementById('main-dash');
        dash.classList.add('loading');

        // è«‹æ±‚ URLï¼šåŒ…å«ç›®å‰å¤©æ°£ã€æ¯å°æ™‚é å ±ã€æ¯æ—¥é å ±
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset&timezone=auto`;

        try {
            const res = await fetch(url);
            const data = await res.json();
            renderData(data);
        } catch (e) {
            console.error(e);
            alert("è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯");
        } finally {
            dash.classList.remove('loading');
        }
    }

    function renderData(data) {
        const current = data.current;
        const daily = data.daily;
        const hourly = data.hourly;
        const wInfo = getW(current.weather_code);

        // 1. Hero Section
        document.getElementById('hero-temp').innerText = Math.round(current.temperature_2m) + "Â°";
        document.getElementById('hero-text').innerText = wInfo.t;
        document.getElementById('hero-icon').innerText = wInfo.i;
        document.getElementById('today-high').innerText = Math.round(daily.temperature_2m_max[0]);
        document.getElementById('today-low').innerText = Math.round(daily.temperature_2m_min[0]);

        // 2. Hourly Scroll (Next 24 Hours)
        const hourlyContainer = document.getElementById('hourly-container');
        hourlyContainer.innerHTML = '';
        
        // æ‰¾å‡ºç›®å‰å°æ™‚çš„ index
        const nowHour = new Date().getHours();
        
        // é¡¯ç¤ºæœªä¾† 24 å°æ™‚
        for(let i = nowHour; i < nowHour + 24; i++) {
            if(!hourly.time[i]) break;
            const timeStr = new Date(hourly.time[i]).getHours() + ":00";
            const code = hourly.weather_code[i];
            const temp = Math.round(hourly.temperature_2m[i]);
            
            const div = document.createElement('div');
            div.className = 'hour-item';
            div.innerHTML = `
                <div class="hour-time">${i === nowHour ? 'ç¾åœ¨' : timeStr}</div>
                <div class="hour-icon">${getW(code).i}</div>
                <div class="hour-temp">${temp}Â°</div>
            `;
            hourlyContainer.appendChild(div);
        }

        // 3. Daily Forecast (7 Days)
        const dailyContainer = document.getElementById('daily-container');
        dailyContainer.innerHTML = '';
        
        for(let i = 0; i < 7; i++) {
            const date = new Date(daily.time[i]);
            const dayName = i === 0 ? "ä»Šå¤©" : date.toLocaleDateString('zh-TW', { weekday: 'long' }).replace('æ˜ŸæœŸ', 'é€±');
            const code = daily.weather_code[i];
            const max = Math.round(daily.temperature_2m_max[i]);
            const min = Math.round(daily.temperature_2m_min[i]);

            const row = document.createElement('div');
            row.className = 'day-row';
            row.innerHTML = `
                <div class="day-name">${dayName}</div>
                <div class="day-icon">${getW(code).i}</div>
                <div class="day-temp-bar">
                    <span>${min}Â°</span>
                    <span style="opacity:0.3">/</span>
                    <span class="temp-high">${max}Â°</span>
                </div>
            `;
            dailyContainer.appendChild(row);
        }

        // 4. Details Grid
        document.getElementById('detail-feels').innerText = Math.round(current.apparent_temperature) + "Â°";
        document.getElementById('detail-humidity').innerText = current.relative_humidity_2m + "%";
        document.getElementById('detail-wind').innerText = current.wind_speed_10m;
        
        // è™•ç†æ—¥è½æ™‚é–“
        const sunsetTime = new Date(daily.sunset[0]);
        const sunsetStr = sunsetTime.toLocaleTimeString('zh-TW', {hour: '2-digit', minute:'2-digit', hour12: false});
        document.getElementById('detail-sun').innerText = sunsetStr;
    }

    // åŸå¸‚åˆ‡æ›èˆ‡å®šä½
    function changeCity() {
        const select = document.getElementById('city-select');
        const val = select.value;

        if(val === 'gps') {
            if(navigator.geolocation) {
                select.options[select.selectedIndex].text = "ğŸ“¡ å®šä½ä¸­...";
                navigator.geolocation.getCurrentPosition(pos => {
                    select.options[select.selectedIndex].text = "ğŸ“ æˆ‘çš„ä½ç½®";
                    fetchWeather(pos.coords.latitude, pos.coords.longitude);
                }, () => {
                    alert("å®šä½å¤±æ•—");
                    select.value = "25.0330,121.5654"; // å›å°åŒ—
                    fetchWeather(25.0330, 121.5654);
                });
            }
        } else {
            const [lat, lon] = val.split(',');
            fetchWeather(lat, lon);
        }
    }

    // åˆå§‹è¼‰å…¥
    window.onload = () => {
        const [lat, lon] = document.getElementById('city-select').value.split(',');
        fetchWeather(lat, lon);
    };

</script>

</body>
</html>
